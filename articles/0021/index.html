<div class="article">
<h2>Integrating CruiseControl and ClearCase UCM</h2>
<p>by <a
	href="mailto:kevin.lee@uk.ibm.com?subject=Integrating_CruiseControl_and_UCM">Kevin
A. Lee</a></p>
<h3>Introduction</h3>
<p>In this article I will discuss how to configure CruiseControl to
work with UCM - the ClearCase best practice usage model. Until recently,
ClearCase UCM users have had to make use of the CruiseControl <span
	style="font-family: monospace;">&lt;clearcase&gt;</span> plugin which
is a Base ClearCase implementation and reports on element versions only
- not UCM activities and their contents. However, in recent releases of
CruiseControl there is now a&nbsp; <span style="font-family: monospace;">&lt;ucm&gt;</span>
plugin and also a&nbsp; related&nbsp;<span
	style="font-family: monospace;">&lt;clearcasebaselinepublisher&gt;</span>
plugin. There is also a basic integration to the ClearQuest web
interface from the CruiseControl reporting application. In this article
I will describe how to configure each of these. Note that these plugins
requires ClearCase version 6 (2003.00.00 or later) to work correctly.</p>
<h3>Configure your ClearCase environment</h3>
<p>In order to take advantage of CruiseControl, you must first
decide how to configure your ClearCase environment, that is how you will
create UCM projects and the streams within them. Out-of-the-box, new UCM
projects provide support for &quot;traditional parallel
development&quot;, by creating both an integration stream and a stream
for each developer. However, you do not need to adopt this approach. For
example, if you are intending to carry out Continuous Integration, then
you will probably just create a single integration stream (which each
developer has a view onto) and maybe also a release stream. Whatever
strategy you adopt, it is assumed in this example that you will be
building in a ClearCase view looking onto the integration stream.</p>
<h3>Configure Ant project build file</h3>
<p>A project build file is your Ant &quot;<span
	style="font-family: monospace;">build.xml</span>&quot; file or
equivalent that describes the targets and tasks that your build is to
run. The project build file and its relationship with CruiseControl is
discussed in more detail <a
	title="CruiseControlWithClearCaseSnapshotViews"
	href="http://www.buildmeister.com/modules/content/index.php?id=9">here</a>.
I will assume that the Ant build target to be invoked in this project
build file is called &quot;<span style="font-style: italic;">integration</span>&quot;.</p>
<h3>Configure CruiseControl configuration file</h3>
<p>To configure CruiseControl to monitor your UCM environment and
call its project build file on any changes, you would create a &quot;<span
	style="font-family: monospace;">config.xml</span>&quot; file similar to
that shown below. &nbsp;Note that in this example, I am building a
project called&nbsp;<span style="font-style: italic;">Example</span> and
that a snapshot build view has already been created for this project as
&quot;<span style="font-family: monospace;">C:\Views\Example_build</span>&quot;.
I will also assume that the integration stream&nbsp;<span
	style="font-style: italic;">Example_Int</span> is the name of the
integration stream that is going to monitored for changes and that there
is a single VOB called <span style="font-weight: bold;">ExampleVOB</span>.</p>
<div class="codelisting">&lt;plugin
name=&quot;labelincrementer&quot;<br />
&nbsp;classname=&quot;net.sourceforge.cruisecontrol.labelincrementers.FormattedLabelIncrementer&quot;/&gt;<br />
<br />
<span style="font-weight: bold;">&lt;plugin name=&quot;ucm&quot;</span><br
	style="font-weight: bold;" />
<span style="font-weight: bold;">&nbsp;classname=&quot;net.sourceforge.cruisecontrol.sourcecontrols.UCM&quot;/&gt;</span><br
	style="font-weight: bold;" />
<br style="font-weight: bold;" />
<span style="font-weight: bold;">&lt;plugin
name=&quot;clearcasebaselinepublisher&quot;</span><br
	style="font-weight: bold;" />
<span style="font-weight: bold;">&nbsp;classname=&quot;net.sourceforge.cruisecontrol.publishers.ClearCaseBaselinePublisher&quot;/&gt;
</span><br />
<br />
&lt;project name=&quot;Example&quot;&gt;<br />
&nbsp; &nbsp; &lt;property name=&quot;build.view&quot;
value=&quot;C:\Views\Example_build&quot;/&gt;<br />
&nbsp; &nbsp; &lt;property name=&quot;build.dir&quot;
&nbsp;value=&quot;${build.view}\ExampleVOB&quot;/&gt;<br />
&nbsp; &nbsp;<span style="font-weight: bold;">
&lt;labelincrementer defaultLabel=&quot;EXAM_1_INT&quot;/&gt;</span><br />
&nbsp; &nbsp; &lt;listeners&gt;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &lt;currentbuildstatuslistener <br />
&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;file=&quot;logs\${project.name}\buildstatus.txt&quot;/&gt;<br />
&nbsp; &nbsp; &lt;/listeners&gt;<br />
&nbsp; &nbsp; &lt;bootstrappers&gt;<br />
&nbsp; &nbsp; &nbsp; &nbsp;<span style="font-weight: bold;">
&lt;clearcasebootstrapper </span><br style="font-weight: bold;" />
<span style="font-weight: bold;">&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;file=&quot;build.xml&quot; </span><br style="font-weight: bold;" />
<span style="font-weight: bold;">&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;viewPath=&quot;${build.dir}&quot;/&gt;</span><br />
&nbsp; &nbsp; &lt;/bootstrappers&gt;<br />
&nbsp; &nbsp; &lt;modificationset&gt;<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="font-weight: bold;">&lt;ucm
stream=&quot;Example_Int&quot; </span><br style="font-weight: bold;" />
<span style="font-weight: bold;">&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;viewpath=&quot;${build.dir}&quot; </span><br style="font-weight: bold;" />
<span style="font-weight: bold;">&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;contributors=&quot;true&quot;/&gt;</span><br />
&nbsp; &nbsp; &lt;/modificationset&gt;<br />
&nbsp; &nbsp; &lt;schedule interval=&quot;600&quot;&gt;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &lt;ant
antscript=&quot;C:\Views\java_tools\JavaTools\bin\ant.bat&quot;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;antWorkingDir=&quot;${build.dir}<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;buildfile=&quot;${build.dir}&quot;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;target=&quot;integration&quot;/&gt;<br />
&nbsp; &nbsp; &lt;/schedule&gt;<br />
&nbsp; &nbsp; &lt;log&gt;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &lt;merge
file=&quot;${build.dir}\build\TESTS-*.xml&quot;/&gt;<br />
&nbsp; &nbsp; &lt;/log&gt;<br />
&nbsp; &nbsp; &lt;publishers&gt;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &lt;htmlemail
mailhost=&quot;smtp.mailhost.com&quot; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;returnaddress=&quot;bldadmin&quot;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;spamwhilebroken=&quot;true&quot; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;subjectprefix=&quot;[CruiseControl]:
&quot; <br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;buildresultsurl=&quot;true&quot;/&gt;<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="font-weight: bold;">&lt;clearcasebaselinepublisher
viewtag=&quot;Example_build&quot;/&gt; </span><br />
&nbsp; &nbsp; &lt;/publishers&gt;<br />
&lt;/project&gt;</div>
<p>In this example, I am making use of the <span
	style="font-family: monospace;">&lt;ucm&gt;</span> source control
plugin. This plugin takes a number of parameters: the UCM stream (which
is used to query the underlying Base ClearCase branch), the path into a
view to check for changes and whether contributor activities should be
reported on or not. Contributor activities are those that have been
&quot;delivered&quot; from a child stream into an integration
activity.&nbsp;</p>
<p>I am also using <span style="font-family: monospace;">&lt;clearcasebaselinepublisher&gt;</span>
publisher.&nbsp;This plugin creates a ClearCase UCM baseline for the
specified view's integration stream. It uses the value of the
CruiseControl generated <span style="font-family: monospace;">${label}</span>
property as well as the value of the <span
	style="font-family: monospace;">baselineprefix </span>attribute (if
specified) to name the baseline. A baseline is only created if UCM
modifications are recorded in the build log. By default an incremental
baseline is created although a full baseline can be created too
(incremental baselines if at all are recommended for Continuous
Integration).</p>
<p>At the beginning of the listing the <span
	style="font-family: monospace;">&lt;labelincrementer&gt;</span> plugin
is used to create a baseline format suitable for ClearCase.</p>
<p style="font-style: italic;">Please note that
the&nbsp;implementation of the <span style="font-family: monospace;">&lt;ucm&gt;</span>
plugin means that <span style="font-family: monospace;">Example_Int</span>
in the above example is actually the branch type, and not the stream
name. Although you can rename your stream,&nbsp;the underlying branch
type will remain the same.</p>
<h3>Configuring ClearQuest reporting</h3>
<p>If you are using ClearQuest as well you can additionally navigate
from each UCM modification in the CruiseControl Build Results web to the
ClearQuest record that is associated with it. The CruiseControl XSL
files have already been populated with sufficient logic to achieve this,
however you will need to configure them appropriately for your own
ClearQuest environment. To do so, edit the file <span
	style="font-family: monospace;">modifications.xsl</span>, which is in
the directory <span style="font-family: monospace;">reporting/jsp/webcontent/xsl</span>
in the source distribution or the <span style="font-family: monospace;">webapps/cruisecontrol/xsl</span>
directory of the binary distribution. You will need to change the
following variables:</p>
<ul>
	<li><em>cqserver</em> - the name of your ClearQuest server</li>
	<li><em>cqschema</em> - the name of your ClearQuest schema</li>
	<li><em>cqdb</em> - the name of your ClearQuest database</li>
	<li><em>cqlogin</em> - the name of an example user to login as</li>
	<li><em>cqpassword</em> - the password of the example user</li>
</ul>
<p>Note that for security reasons, you might want to grant this
example user read-only privileges. However you could also remove the
login logic from the XSL file so that the user has to login each time.</p>
<p>For more information on integrating ClearCase and CruiseControl
please see the book:&nbsp;</p>
<p style="margin-left: 40px;"><a
	href="http://www.amazon.com/gp/product/0321356993?ie=UTF8&amp;tag=thebuildmeist-20&amp;linkCode=as2&amp;camp=1789&amp;creative=9325&amp;creativeASIN=0321356993">IBM
Rational(R) ClearCase(R), Ant, and CruiseControl: The Java(TM)
Developer's Guide to Accelerating and Automating the Build Process</a><img
	width="1" height="1" border="0"
	src="http://www.assoc-amazon.com/e/ir?t=thebuildmeist-20&amp;l=as2&amp;o=1&amp;a=0321356993"
	alt=""
	style="border: medium none ! important; margin: 0px ! important;" /></p>
</div>