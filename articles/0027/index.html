<div id="article">
<h1>Automating the PHP build and deployment process</h1>
<p id="articlehead">This article describes how to implement a controlled
and automated build and deployment process for applications written in PHP.</p>
<h2>Introduction</h2>
<p>
PHP is a scripting language, designed for rapidly producing dynamic web pages.
Unlike traditional programming languages such as Java, C or C# there is no direct
"compilation" build process with PHP and deployment can (in theory) be a simple
matter of copying PHP developed files to a production web server.
</p>
<p>
In reality however, PHP is a programming language that exhibits all of the issues
that usually appear when multiple developers are making changes to a single
evolving codebase. In comparison with other language communities the PHP community
has been relatively slow in introducing quality code inspection and testing tools.
There has also been little documentation on how best to automate the deploy of
PHP applications to multiple run-time environments.
</p>
<p>This article therefore defines an approach on how to implement a PHP build and
deployment process. It uses phing, FTP and various PHP inspection and testing tools
in order to implement a secure, automated and controlled build and deployment process.
</p>
<h2>Phing - the PHP build tool</h2>
<p>You can in theory use any number of build tools for building PHP, including tools
such as Apache Ant, make or SCons. However it is often best to make use a build tool
that understands the language domain. In the case og PHP one such build tool is phing.
This tool is based on Apache Ant so any user who has experience of Ant will have no
problem in using it.</p>
<p>The input to phing is a textual build script by default called <b>build.xml</b>
(although any filename can be used). Each build script describes a set of <b>targets</b>,
which are the core parts of the composite build process, e.g. parse files for errors,
run unit tests, create a PEAR package and so on.</p>
<p>Each of the targets can make reference to any of phing's built-in <b>tasks</b>,
to carry out a predefined operation, e.g. create a tar archive. Parameters can be specified
for the task, defining its exact invocation. There are a large number of built-in
tasks (see the <a href="http://ant.apache.org/manual">phing manual</a> for
details), however, you
can quite easily extend phing by creating new tasks yourselves.</p>
<p>An example of calling phing from the command line to execute a
&quot;release&quot; target would be as follows:</p>
<div id="codeoutput">&gt;ant -f myapp.xml release<br />
</div>
<p>Here the &quot;-f&quot; option is used to specify the name of the
build script that you wish to use (<strong>atm.xml</strong>) and the
target which will be executed is the &quot;release&quot; target.</p>
<p>One of the most important things to note is that Ant in
itselfis not a compiler, rather it invokes your Java compiler
&quot;javac&quot; through its built-in <strong>&lt;javac&gt;</strong>
task. This task, recursively scans source and destination directories to
look for Java classes that need to be (re)built and optimizes calls to
the Java compiler.</p>
<h2>An Example</h2>
<p>An example of an Ant build script to compile a set of Java
classes (for an ATM application) and produce a releasable &quot;<b>.jar</b>&quot;
file is given below:</p>
<pre name="code" class="xml">
&lt;?xml version=&quot;1.0&quot;&gt;

&lt;project name=&quot;atm&quot; default=&quot;compile&quot; basedir=&quot;.&quot;&gt;
    &lt;property name=&quot;dir.src&quot;   value=&quot;src&quot;/&gt;
    &lt;property name=&quot;dir.build&quot; value=&quot;build&quot;/&gt;
    &lt;property name=&quot;dir.dist&quot;  value=&quot;dist&quot;/&gt;
    &lt;property name=&quot;dir.libs&quot;  value=&quot;C:\JavaTools\libs&quot;/&gt;

    &lt;!-- define a classpath to be used throughout the project --&gt;
    &lt;path id=&quot;classpath&quot;&gt;
        &lt;pathelement location=&quot;{$dir.build}/&gt;
        &lt;!-- include third party libraries --&gt;
        &lt;fileset dir=&quot;${dir.libs}&quot;&gt;
            &lt;include name=&quot;*.jar&quot;/&gt;
        &lt;/fileset&gt;
    &lt;/path&gt;

    &lt;!-- initialise directory structure --&gt;
    &lt;target name=&quot;init&quot; description=&quot;initialise directory structure&quot;&gt;
        &lt;mkdir dir=&quot;${dir.build}&quot;/&gt;
        &lt;mkdir dir=&quot;${dir.dist}&quot;/&gt;
    &lt;/target&gt;

    &lt;!-- remove generated files --&gt;
    &lt;target name=&quot;clean&quot; description=&quot;remove generated files&quot;&gt;
        &lt;delete dir=&quot;${dir.build}&quot;/&gt;
        &lt;delete dir=&quot;${dir.dist}&quot;/&gt;
    &lt;/target&gt;

    &lt;!-- compile source code --&gt;
    &lt;target name=&quot;compile&quot; depends=&quot;init&quot; description=&quot;compile source code&quot;&gt;
        &lt;javac destdir=&quot;${dir.build}&quot; &gt;
            &lt;src path=&quot;${dir.src}&quot;/&gt;
            &lt;classpath refid=&quot;classpath&quot;/&gt;
        &lt;/javac&gt;
    &lt;/target&gt;

    &lt;!-- create distribution archive --&gt;
    &lt;target name=&quot;dist&quot; depends=&quot;compile&quot; description=&quot;create distribution archive&quot;&gt;
        &lt;jar jarfile=&quot;${dir.dist}/${ant.project.name}.jar&quot;
            basedir=&quot;${dir.build}&quot;
            includes=&quot;**/*.class&quot;&gt;
        &lt;/target&gt;

&lt;/project&gt;
</pre>
<p>If this build script was used to build the ATM application then
the output result would look similar to the following:</p>
<div id="codeoutput">
<p><b>&gt;ant -f atm.xml clean</b><br />
Buildfile: atm.xml<br />
<br />
clean:<br />
<br />
BUILD SUCCESSFUL<br />
Total time: 0 seconds<br />
<br />
<b>&gt;ant -f atm.xml</b><br />
Buildfile atm.xml<br />
<br />
init:<br />
[mkdir] Created dir:C:\Build\ATM\build<br />
[mkdir] Created dir:C:\Build\ATM\dist<br />
<br />
compile:<br />
[javac] Compiling 4 source files to
C:\Build\ATM\build<br />
<br />
BUILD SUCCESSFUL<br />
Total Time: 4 seconds<br />
</p>
</div>
<p>In this build script a Java archive called <b>atm.jar</b> is
being built. There are four targets: <strong>init</strong>, <strong>clean</strong>,
<strong>compile</strong> and <strong>dist</strong>. Sometimes a target
will have a dependency on another target, for example before you create
a distribution (<strong>.jar</strong>) file, you would need to compile
the source code. These dependencies are easily specified via a <strong>depends</strong>
attribute in the target. You can see this with the <strong>dist</strong>
target on line 40 (where the target requires the <strong>compile</strong>
target to be executed first). Ant will automatically execute any
dependencies.</p>
<p>You will see that on lines 4-7 the script makes reference to <strong>property</strong>
values. In Ant, properties are equivalent to most programming language's
concept of variable constants; that is to say they are immutable and
once properties have been assigned a value they cannot be
changed.Here they are being used to define directory names. You
make references to properties by using the <font face="Courier New">${property_name}</font>
symbols (see line 11 for an example). An interesting feature of
properties is that they can be overridden from the command line. For
example, if you wanted to override the <strong>dir.build</strong>
property, you could use the following:</p>
<div id="codeoutput">
<p><b>&gt;ant -f atm.xml compile -Ddir.build=bin</b></p>
</div>
<p>If you are compiling source code in Java you will need to define
a <strong>classpath.</strong>This is the combination of libraries
containing pre-built classes, that you need to build against. In lines
10-16 a classpath is defined which looks at the <font face="Courier New">build</font>
directory as well as a set of third party <strong>.jar</strong> files
held at the location <font face="Courier New">C:\JavaTools\lib.</font></p>
<p>One final point worthy of note is the use of Ant's built in
variables. In this example, on line 40 we are using the <font
	face="Courier New">${ant.project.name}</font> variable when creating a
jar file, this refers to the project name <strong>atm</strong>as
defined in line 3, so the name of jar file will be <strong>atm.jar</strong>.</p>

</p>
<h2>PHP code inspection and testing</h2>
<p>
In [] I defined a number of build and deployment functions...
static analysis
unit testing
code coverage

</p>

<h2>PHP deployment</h2>
<p>
....
</p>

<h2>Putting it all together</h2>


to support the development
<div id="codeoutput">&gt;cleartool catcr
Account.o@@15-Jan.20:28.110</div>
<p>...:</p>
<div id="codeoutput">Derived object:

<h2>References</h2>
<ul>
	<li><a
		href="...">Phing home page.</a>
	</li>
</ul>
</div>