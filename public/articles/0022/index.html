<div id="article">
			<h1>Apache Ant and IBM Rational Build Forge</h2>
			<p id="articlehead">This article is an introduction to IBM Rational Build Forge
			- an enterprise build and release execution framework. It takes you through the
			process of how to configure and build an Apache Ant based Java project within Build Forge.</p>
			<h2>Introduction</h2>
			<p><a href="www.ibm.com/software/awdtools/buildforge">Build Forge</a> is an Enterprise build
			and release execution framework that allows development organizations to standardize and
			automate repetitive tasks. It works in combination with tools such as Ant to "orchestrate"
			an end-to-end build, testing and release process. Build Forge has been designed to be
			technology and platform neutral. It is open enough to be able to execute, manage and report
			on any process consisting of a sequence of command line steps and/or scripts. It also
			integrates with a number of version control tools to report on and monitor the changes
			that go into builds.</p>
			<p>Build Forge has a three-tier system architecture as illustrated in the diagram below.
			Unlike CruiseControl, Build Forge uses a relational database to persistently store build
			projects and executions, and enable complete security and permissions. By default Build Forge
			comes with a supported DB2 express database; however it can be made to work with many other
			commercial databases including MySQL, Sybase, Microsoft SQL Server and Oracle.</p>
			<p style="text-align: center;"><img
				alt="[BuildForge Architecture Diagram]"
				src="%image_dir%/BuildForge-Architecture.gif" /></p>
			<p>The Build Forge <b>Server</b> is the heart of the system and oversees the activities
			that are executed on your build and test machines, including execution, logging, email
			notifications and auditing. Build Forge <b>Agents</b> are installed on the machines to be controlled.
			The Server sends commands to the Agents for execution; the Agents execute then, and then
			return the results to the Server for diagnosis.</p>
			<p>The <b>Management Console</b> is the main control user interface for the system. Through
			it you organize the individual scripts or command line executions that are part of your build
			process into Build Forge projects and manage the servers and environments that they will be
			executed on. An additional interface is provided for <b>Developer Self Service</b>. This interface
			integrates part of the Management Console into the developers IDE (which can be either
			Eclipse or Visual Studio.NET based). It allows developers to execute their own private
			builds using the Build Forge infrastructure and also to view build projects, status and
			results without leaving their IDE. There is also a unique capability which allows the
			developer to selectively choose local file changes from within the IDE and "reflect"
			them into a controlled Build Forge build. Using this capability, developers can gain
			confidence that the changes they are making will not break the team's integration build
			when they commit them into the repository.</p>
			<h2>Installing Build Forge</h2>
			<p>The first decision to make with regards to
			your Build Forge installation is which database server technology to
			use. Build Forge 7.0 and onwards can be installed automatically with
			a copy of DB2 Express, however if you have a preferred or existing
			database server, such as Oracle, SQL Server or MySQL then you can
			easily use them instead. Once you have decided on your database,
			the general installation process is as follows:</p>
			<ul>
				<li>Install the <span style="font-weight: bold;">IBM
				Rational FlexLM License Server</span> (if not already installed).</li>
				<li>Request and install your Build Forge license keys from the
				<a
					href="https://www14.software.ibm.com/webapp/iwm/web/preLogin.do?source=rational">IBM
				Rational Licensing Center</a>.</li>
				<li>Create a database instance and database owner for Build
				Forge to make use of.</li>
				<li>Install the <span style="font-weight: bold;">Build
				Forge Management Console</span> on a specific server and specific port.</li>
				<li>Install the latest Build Forge interim fixes (see <a
					href="http://www-306.ibm.com/software/awdtools/buildforge/support/">here</a>
				for the latest versions).</li>
				<li>Install the <span style="font-weight: bold;">Build
				Forge Agents</span> on the machines you wish to execute your commands on,
				i.e. your build, version control or test servers.</li>
			</ul>
			<p>The exact setup for each database will
			vary,&nbsp;refer to the latest Build Forge release notes for further
			information.&nbsp;</p>
			<p>Build Forge has a graphically driven user interface for defining build and release processes.
			There are many "Enterprise" capabilities that you can take advantage of when defining these process.
			Therefore, rather than describing how a complete end-to-end process can be implemented,
			for purposes of brevity, I will instead concentrate on how Apache Ant can be best integrated and
			invoked as part of a complete Build Forge build process.</p>
			<h2>The Build Forge Workspace</h2>
			<p>For every project to be executed by Build Forge, you can either create a specific build
			workspace or configure a step in the Build Forge project to create a new workspace for you.
			Creating a new workspace on each build is the recommended approach. This is made practical
			with Build Forge because you can either create an additional "cleanup" step at the end of
			the project, or even create a "cleanup" project that is automatically invoked after a certain
			number of builds. Creating a new workspace on each build helps ensure a clean and repeatable
			build process and also allows developers to make use of the self service "reflection"
			capability. In this article I will define a Build Forge project that creates and removes
			its own build workspace.</p>
			<h2>Build Forge Environment Groups</h2>
			<p>A Build Forge <b>Environment Group</b> is a collection of environment variables, for example the
			<i>PATH</i> or <i>JAVA_HOME</i> setting. Build Forge maintains these separately so that they
			can be assigned to servers, projects and even individual project steps as and when needed.
			As this approach does not rely on the values you last set in your login shell or system,
			this can help make your build process more repeatable. As well as operating system specific
			environment variables you can also create internal Build Forge environment variables which
			can then be used to configure the flow and execution of your project.</p>
			<p>For building projects using Apache Ant, I recommend creating at least two Environment Groups
			for your build process as follows:</p>
			<ul>
			<li>A server based Environment Group<br/>which defines variables to refer to the locations of your
			build tools, for example your Ant home directory and the system path.</li>
			<li>A project based Environment Group<br/>which defines variables specific to your build project,
			for example the name of your project in its version control repository.</li>
			</ul>
			<p>An example of the Environment Group that could be used for building the project <i>Hotel de Java</i>
			is illustrated below:</p>
			<div style="text-align: center;"><img
				alt="[BuildForge Project Environment]"
				src="%image_dir%/BuildForge-ProjectEnvironment.jpg" /><br />
			</div>
			<h2>Build Forge Projects</h2>
			<p>A Build Forge <b>project</b> is the name for the overall process flow that is to be executed.
			Build Forge <b>steps</b> are the various tasks that are performed within the project. Each step is
			basically one or more command line statements that are to be executed on an Agent. A Build Forge
			project is typically created for each application you wish to build. In our example I will
			create a single Build Forge project for executing the <i>Hotel de Java</i> integration build.</p>
			<p>As an example, the complete set of Build Forge steps required to compile, test and deploy
			(to a development server) the <i>Hotel de Java</i> application could be defined as listed in
			the table below:</p>
			<div align="center">
			<table id="nicewidth">
				<tbody>
					<tr>
						<th width="25%">
						<p><strong>Step</strong></p>
						</th>
						<th>
						<p><strong>Command</strong></p>
						</th>
					</tr>
					<tr>
						<td >
						<p><strong>Create Workspace</strong></p>
						</td>
						<td >
						<p><font face="Courier New">cleartool mkview -snapshot -tag
						&quot;${PROJECT_NAME}_$BF_TAG&quot; -stgloc -auto</font></p>
						</td>
					</tr>
					<tr>
						<td >
						<p><strong>Update Workspace</strong></p>
						</td>
						<td >
						<p><font face="Courier New">cleartoolupdate
						-add_loadrules $SOURCE_VOB</font></p>
						</td>
					</tr>
					<tr>
						<td >
						<p><strong>Clean Workspace</strong></p>
						</td>
						<td >
						<p><font face="Courier New">ant clean</font></p>
						</td>
					</tr>
					<tr>
						<td >
						<p><strong>Static Analysis</strong></p>
						</td>
						<td >
						<p><font face="Courier New">.test &quot;CheckStyle IF&quot; CheckStyleAll</font></p>
						</td>
					</tr>
					<tr>
						<td >
						<p><strong>Compile Source Code</strong></p>
						</td>
						<td >
						<p><font face="Courier New">ant compile</font></p>
						</td>
					</tr>
					<tr>
						<td >
						<p><strong>Execute Unit Tests</strong></p>
						</td>
						<td >
						<p><font face="Courier New">.test &quot;JUnit IF&quot; JUnitAll</font></p>
						</td>
					</tr>
					<tr>
						<td >
						<p><strong>Create Documentation</strong></p>
						</td>
						<td >
						<p><font face="Courier New">ant javadoc</font></p>
						</td>
					</tr>
					<tr>
						<td >
						<p><strong>Create Distribution Archive</strong></p>
						</td>
						<td >
						<p><font face="Courier New">ant dist</font></p>
						</td>
					</tr>
					<tr>
						<td >
						<p><strong>Stage Archive</strong></p>
						</td>
						<td >
						<p><font face="Courier New">ant -Dbuild.num=$BF_TAG
						stage</font></p>
						</td>
					</tr>
					<tr>
						<td >
						<p><strong>Create Baseline</strong></p>
						</td>
						<td >
						<p><font face="Courier New">cleartool mklbtype -nc ${BF_TAG}_INT<br/>
						cleartool mklabel -recurse ${BF_TAG}_INT .</font></p>
						</td>
					</tr>
					<tr>
						<td >
						<p><strong>Deploy Application</strong></p>
						</td>
						<td >
						<p><font face="Courier New">ant deploy</font></p>
						</td>
					</tr>
					<tr>
						<td >
						<p><strong>Remove Workspace</strong></p>
						</td>
						<td >
						<p><font face="Courier New">cleartool rmview -f
						$BF_SERVER_ROOT\${PROJECT_NAME}_$BF_TAG</font></p>
						</td>
					</tr>
				</tbody>
			</table>
			</div>
			<p>You will notice that the majority of the steps in this project are
			calls to Ant targets, although it would be possible to call a single
			Ant target, i.e. &ldquo;<span
				style="font-family: monospace;">ant release</span>&rdquo; to execute
			all of these as dependencies, this would not take advantage of the
			capabilities of Build Forge. By breaking them down as discrete steps,
			if the build fails at a particular step, you can potentially fix the
			problem and restart the build at that step. You can also thread a
			number of these steps by executing them in parallel to save total
			build time.&nbsp;</p>
			<p>As well as calls to Ant, this example also contains steps to execute
			ClearCase commands using its command line tool &quot;cleartool&quot;. In
			this example Base ClearCase is being used to create a new workspace (ClearCase view),
			create a baseline and remove the workspace when the build has completed.
			Finally you will also see steps that call Build Forge DOT commands - in this case
			the &quot.test&quot interface to call CheckStyle and JUnit Build Forge adaptors.
			<h2>Build Forge Adapters and Filters</h2>
			<p>In CruiseControl everything is a plugin, if you wanted to implement an
			integration to a new tool you would need to write the source code for the plugin.
			Build Forge uses a different and potentially more scaleable mechanism. Rather than
			write plugins for integrations, you can take advantage of the extension capabilities of Build Forge,
			in particular <b>Filters</b> and <b>Adaptors</b>.</p>
			<p>Not every command you wish to execute from Build Forge will always terminate with an
			appropriate exit code. One such example is the Windows Ant batch file which terminates with a
			successful exit code irrespective of whether the build passed or failed. In this case rather
			than determining success or failure of the step based on exit code you can create a filter
			to parse the output of the command by searching for appropriate text in the build log.
			When an Ant build fails the build output always includes the message &quot;BUILD FAILED&quot;.
			It is therefore safe to create a Build Forge filter which searches for this string.
			Once you have created the filter, rather than selecting &quot;Exit Code&quot; as the determinant
			of success or failure, you would select the name of your Ant filter. An example of how the
			Filters could be used for the <i>Hotel de Java</i> project is illustrated in below:</p>
			<p style="text-align: center;"><img
				alt="[BuildForge Project Steps]"
				src="%image_dir%/BuildForge-Steps.jpg" /></p>
			<p>Adaptors are how you interface Build Forge with version control, defect, test and many other
			kinds of tools. Basically, the adaptor is the application of an interface to a project. The
			interface is an XML file which executes the command line functionality available via the
			version control, defect or test system and manipulates its output. There are a number of
			out-of-the-box interfaces delivered with Build Forge, including integrations for most version
			control tools that report on the baselines and changes that have gone into builds.</p>
			<p>You can of course also implement your own interfaces. In this example I have implemented two &quot;test&quot;
			interfaces that basically call CheckStyle and JUnit via their relevant target in Ant, for example
			&quot;ant checkstyle&quot; or &quot;ant junit&quot;. They then parse the build output to determine success
			or failure and then write the results to the Build Forge Bill of Materials (BOM). An example of a BOM
			for a completed execution of the Hotel de Java project is illustrated below:</p>
			<p style="text-align: center;"><img
				alt="[BuildForge Bill of Materials]"
				src="%image_dir%/BuildForge-BOM.jpg" /></p>
			<p>There are a large number of interfaces delivered with Build Forge and new ones are continually being made
			available by IBM and its community of users.</p>
			<h2>Build Forge Scheduling</h2>
			<p>Build Forge allows projects to be scheduled and executed based on a number of criteria.
			The interface to the scheduler is graphical and uses similar concepts to that of the popular
			UNIX &quot;cron&quot; scheduler. An example of a schedule to build the <i>Hotel de Java</i> project
			every 20 minutes is illustrated below:</p>
			<p style="text-align: center;"><img
				alt="[BuildForge Schedule]"
				src="%image_dir%/BuildForge-Schedule.jpg" /></p>
			<p>This is a continuous integration schedule which also requires the out-of-the-box
			version control (in this case ClearCase) adaptor interface to be enabled. This adaptor checks
			for changes in the repository, so although I have scheduled the project to build every 20
			minutes, it will only do so if changes are found. You can create as many schedules as you want;
			other scenarios would include implementing daily or nightly builds at specific times.</p>
			<h2>Summary</h2>
			<p>In this article I have described how you can integrate Ant with IBM Rational Build Forge
			to schedule, execute and report on a complete end-to-end build process to ensure traceability
			and auditability in your build process. By combining build scripting tools such as Ant
			with higher level build control tools you can adopt a more regular build process that in
			many ways can take care of itself. The productivity gain from automating these aspects can
			be significant.</p>
			<p>As well as using build control tools to execute the mechanics of your build process
			such as compilation, you can also use them to automate aspects of your release and
			deployment process. This is particularly true of Build Forge where its security capabilities
			allow controlled deployment and execution. Using some of the capabilities of these tools
			together with the packaging and deployment capabilities of Ant, you can implement a very
			sophisticated, scaleable and productive end-to-end build and release process.</p>
			<h2><a name="references"></a>References</h2>
			<ul>
				<li><a href="http://www.eclipse.org/">IBM Rational Build
				Forge Homepage</a></li>
				<li><a
					href="http://www-128.ibm.com/developerworks/rational/library/jun06/bergeron/">Introducting
				IBM Rational Build Forge</a></li>
				<li><a
					href="http://www-128.ibm.com/developerworks/rational/library/jun06/lee/">Agile
				SCM and the IBM Rational Toolset</a></li>
			</ul>
</div>